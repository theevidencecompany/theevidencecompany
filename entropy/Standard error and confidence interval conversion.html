<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6875139203647113"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SE & CI Conversion - Entro.py</title>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- SheetJS for Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Disable right-click
        document.addEventListener('contextmenu', e => e.preventDefault());
    
        const redirectHome = () => {
          window.location.href = "index.html";
        };
    
        // DevTools detection
        setInterval(() => {
          if (
            window.outerWidth - window.innerWidth > 160 ||
            window.outerHeight - window.innerHeight > 160
          ) {
            redirectHome();
          }
        }, 500);
    
        // Disable DevTools shortcuts
        document.addEventListener('keydown', e => {
          if (
            e.key === "F12" ||
            (e.ctrlKey && e.shiftKey && ["I","J","C"].includes(e.key)) ||
            (e.ctrlKey && e.key === "U")
          ) {
            e.preventDefault();
            redirectHome();
          }
        });
      </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --brand-primary: #184B44;
            --brand-light: #2a6e64;
            --brand-accent: #e6fffa;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f0fdfa;
            background-image: radial-gradient(#ccfbf1 1px, transparent 1px);
            background-size: 20px 20px;
            margin: 0;
            overflow-x: hidden;
            color: #334155;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-up {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
        }

        /* Card Styles */
        .tool-card {
            background: white;
            border: 1px solid rgba(24, 75, 68, 0.1);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        /* Button Styles */
        .btn-brand {
            background-color: var(--brand-primary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-brand:hover {
            background-color: var(--brand-light);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(24, 75, 68, 0.2);
        }
        .btn-secondary {
            background-color: white;
            color: #334155;
            border: 1px solid #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-secondary:hover {
            border-color: var(--brand-primary);
            color: var(--brand-primary);
            background-color: #f8fafc;
        }
        .btn-danger {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-danger:hover {
            background-color: #fecaca;
            border-color: #f87171;
        }

        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #184B44;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #184B44;
        }
        
        /* Modal */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- Icons ---
        const ArrowLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>;
        const Calculator = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const Download = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
        const Copy = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const AlertCircle = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>;
        const RefreshCw = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const Info = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const XIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="M6 6 18 18"/></svg>;
        const UploadCloud = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>;

        // --- Stats Logic ---
        function inverseNormalCDF(p) {
            // Acklam's algorithm
            const a1 = -3.969683028665376e+01, a2 = 2.209460984245205e+02, a3 = -2.759285104469687e+02;
            const a4 = 1.383577518672690e+02, a5 = -3.066479806614716e+01, a6 = 2.506628277459239e+00;
            const b1 = -5.447609879822406e+01, b2 = 1.615858368580409e+02, b3 = -1.556989798598866e+02;
            const b4 = 6.680131188771972e+01, b5 = -1.328068155288572e+01;
            const c1 = -7.784894002430293e-03, c2 = -3.223964580411365e-01, c3 = -2.400758277161838e+00;
            const c4 = -2.549732539343734e+00, c5 = 4.374664141464968e+00, c6 = 2.938163982698783e+00;
            const d1 = 7.784695709041462e-03, d2 = 3.224671290700398e-01, d3 = 2.445134137142996e+00;
            const d4 = 3.754408661907416e+00;
            const p_low = 0.02425, p_high = 1 - p_low;

            if (p < 0 || p > 1) return NaN;
            if (p === 0) return -Infinity;
            if (p === 1) return Infinity;

            let q, r;
            if (p < p_low) {
                q = Math.sqrt(-2 * Math.log(p));
                return (((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) /
                       ((((d1 * q + d2) * q + d3) * q + d4) * q + 1);
            } else if (p <= p_high) {
                q = p - 0.5;
                r = q * q;
                return (((((a1 * r + a2) * r + a3) * r + a4) * r + a5) * r + a6) * q /
                       (((((b1 * r + b2) * r + b3) * r + b4) * r + b5) * r + 1);
            } else {
                q = Math.sqrt(-2 * Math.log(1 - p));
                return -(((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) /
                        ((((d1 * q + d2) * q + d3) * q + d4) * q + 1);
            }
        }

        function getZScore(confidenceLevel, sides) {
            const alpha = 1 - (confidenceLevel / 100);
            const p = sides === 'two' ? 1 - (alpha / 2) : 1 - alpha;
            return inverseNormalCDF(p);
        }

        function App() {
            const [mode, setMode] = useState('se_to_ci'); // 'se_to_ci' or 'ci_to_se'
            const [sides, setSides] = useState('two'); // 'one' or 'two'
            const [tail, setTail] = useState('right'); // 'right' (Upper Bound) or 'left' (Lower Bound) for one-sided
            
            // Inputs
            const [meanInput, setMeanInput] = useState('');
            const [seInput, setSeInput] = useState('');
            const [lowerInput, setLowerInput] = useState('');
            const [upperInput, setUpperInput] = useState('');
            const [confInput, setConfInput] = useState(''); 

            const [results, setResults] = useState([]);
            const [modalContent, setModalContent] = useState(null); 
            const [inputType, setInputType] = useState('manual'); // 'manual' or 'file'
            const [showColumnSelector, setShowColumnSelector] = useState(false);
            const [fileData, setFileData] = useState(null);
            const [headers, setHeaders] = useState([]);
            
            // Column Mapping State
            const [colMean, setColMean] = useState('');
            const [colSE, setColSE] = useState('');
            const [colLower, setColLower] = useState('');
            const [colUpper, setColUpper] = useState('');
            const [colConf, setColConf] = useState('');

            const fileInputRef = useRef(null);

            // Reset
            const handleReset = () => {
                setMeanInput('');
                setSeInput('');
                setLowerInput('');
                setUpperInput('');
                setConfInput('');
                setResults([]);
                setFileData(null);
                setHeaders([]);
                setShowColumnSelector(false);
                setInputType('manual');
                setColMean(''); setColSE(''); setColLower(''); setColUpper(''); setColConf('');
                if (fileInputRef.current) fileInputRef.current.value = "";
            };

            const calculateRow = (idx, meanStr, val2Str, val3Str, confStr) => {
                const mean = Number(meanStr);
                const conf = Number(confStr);
                
                if (isNaN(mean) || isNaN(conf)) return { id: idx, error: "Invalid Number" };
                if (conf <= 0 || conf >= 100) return { id: idx, error: "Conf% must be 0-100" };

                const z = getZScore(conf, sides);

                if (mode === 'se_to_ci') {
                    const se = Number(val2Str);
                    if (isNaN(se) || se < 0) return { id: idx, error: "Invalid SE" };
                    
                    const margin = z * se;

                    if (sides === 'two') {
                        return {
                            id: idx,
                            input: `Mean=${mean}, SE=${se}, ${conf}% (2-sided)`,
                            output1: (mean - margin).toFixed(4), // Lower
                            output2: (mean + margin).toFixed(4), // Upper
                            type: 'CI'
                        };
                    } else {
                        if (tail === 'right') {
                            return {
                                id: idx,
                                input: `Mean=${mean}, SE=${se}, ${conf}% (1-sided Right)`,
                                output1: (mean + margin).toFixed(4), 
                                type: 'Upper Bound'
                            };
                        } else {
                            return {
                                id: idx,
                                input: `Mean=${mean}, SE=${se}, ${conf}% (1-sided Left)`,
                                output1: (mean - margin).toFixed(4),
                                type: 'Lower Bound'
                            };
                        }
                    }

                } else {
                    // CI -> SE conversion
                    if (sides === 'two') {
                        const lower = Number(val2Str);
                        const upper = Number(val3Str);
                        if (isNaN(lower) || isNaN(upper)) return { id: idx, error: "Invalid Limits" };
                        if (lower > upper) return { id: idx, error: "Lower > Upper" };
                        
                        const se = (upper - lower) / (2 * z);
                        return {
                            id: idx,
                            input: `[${lower}, ${upper}], ${conf}%`,
                            output1: se.toFixed(4),
                            type: 'SE'
                        };
                    } else {
                         // One sided CI -> SE
                         if (isNaN(mean)) return { id: idx, error: "Mean required" };
                         
                         let bound;
                         let inputDesc;
                         
                         if (tail === 'right') {
                             bound = Number(val3Str); // Upper Limit box used for Right Tail Bound
                             inputDesc = `Mean=${mean}, Upper=${bound}, ${conf}%`;
                         } else {
                             bound = Number(val2Str); // Lower Limit box used for Left Tail Bound
                             inputDesc = `Mean=${mean}, Lower=${bound}, ${conf}%`;
                         }

                         if (isNaN(bound)) return { id: idx, error: "Invalid Bound" };
                         
                         const se = Math.abs(bound - mean) / z;
                         return {
                            id: idx,
                             input: inputDesc,
                             output1: se.toFixed(4),
                             type: 'SE'
                         };
                    }
                }
            };

            const handleCalculate = () => {
                const means = meanInput.split(',').map(s => s.trim());
                const confs = confInput.split(',').map(s => s.trim());
                
                let results = [];
                
                if (mode === 'se_to_ci') {
                    const ses = seInput.split(',').map(s => s.trim());
                    const maxLen = Math.max(means.length, ses.length, confs.length);
                    for(let i=0; i<maxLen; i++) {
                        const m = means[i] || "";
                        const s = ses[i] || "";
                        const c = confs[i] || "95"; 
                        if(m==="" && s==="") continue;
                        results.push(calculateRow(i, m, s, null, c));
                    }
                } else {
                    const lowers = lowerInput.split(',').map(s => s.trim());
                    const uppers = upperInput.split(',').map(s => s.trim());
                    const maxLen = Math.max(lowers.length, uppers.length, confs.length, means.length);
                    for(let i=0; i<maxLen; i++) {
                        const l = lowers[i] || "";
                        const u = uppers[i] || "";
                        const c = confs[i] || "95";
                        const m = means[i] || "";
                        if(l==="" && u==="" && m==="") continue;
                        results.push(calculateRow(i, m, l, u, c)); 
                    }
                }
                setResults(results);
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    const data = event.target.result;
                    let rows = [];

                    if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        const workbook = XLSX.read(data, { type: 'binary' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1, defval: "" });
                    } else {
                        // CSV/TXT
                        const text = data;
                        rows = text.split(/\r?\n/).map(row => row.split(','));
                    }
                    
                    if (rows.length > 0) {
                        // Filter out empty rows
                        rows = rows.filter(r => r.some(cell => cell !== null && cell !== "" && cell !== undefined));
                        // Assume first row is header
                        const potentialHeaders = rows[0].map(h => String(h).trim());
                        setHeaders(potentialHeaders);
                        setFileData(rows);
                        setShowColumnSelector(true);
                        setInputType('file');
                        setResults([]);
                    }
                };
                
                if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    reader.readAsBinaryString(file);
                } else {
                    reader.readAsText(file);
                }
            };

            const handleFileProcess = () => {
                // Logic to map columns and populate manual inputs or calculate directly
                // We will populate manual inputs for visibility and then trigger calculation logic
                
                const dataRows = fileData.slice(1); // Skip header

                const getColData = (colIndex) => {
                    if (colIndex === "" || colIndex === undefined) return [];
                    const idx = parseInt(colIndex);
                    return dataRows.map(row => row[idx] !== undefined ? row[idx] : "");
                };

                const meanData = getColData(colMean);
                const seData = getColData(colSE);
                const lowerData = getColData(colLower);
                const upperData = getColData(colUpper);
                const confData = getColData(colConf);

                setMeanInput(meanData.join(', '));
                setSeInput(seData.join(', '));
                setLowerInput(lowerData.join(', '));
                setUpperInput(upperData.join(', '));
                setConfInput(confData.join(', '));

                // Auto-calculate after population? Or let user click calculate. 
                // Let's hide selector and let user click calculate to review data.
                setShowColumnSelector(false);
                setInputType('manual');
            };

            const copyToClipboard = () => {
                const text = results.map(r => {
                     if (mode === 'se_to_ci' && sides === 'two') {
                        return `${r.input}\t${r.output1}\t${r.output2}`;
                     } else {
                         return `${r.input}\t${r.output1}`;
                     }
                }).join("\n");
                
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert("Copied to clipboard!");
                } catch (err) {
                    alert("Failed to copy: " + err);
                }
                document.body.removeChild(textarea);
            };

            const exportCSV = () => {
                let header = "Input,Output";
                if (mode === 'se_to_ci') {
                     header = sides === 'two' ? "Input,Lower CI,Upper CI" : "Input,Bound";
                } else {
                    header = "Input,Standard Error";
                }

                const rows = results.map(r => {
                    if (mode === 'se_to_ci' && sides === 'two') {
                         return `"${r.input}",${r.output1},${r.output2}`;
                    }
                    return `"${r.input}",${r.output1}`;
                }).join("\n");

                const csv = `data:text/csv;charset=utf-8,${header}\n${rows}`;
                const link = document.createElement("a");
                link.setAttribute("href", encodeURI(csv));
                link.setAttribute("download", "results.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            return (
                <div className="min-h-screen flex flex-col">
                     <header className="bg-white border-b border-slate-200 py-4 sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-6 flex items-center justify-between">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => window.location.href='index.html'}>
                                <img src="Entropy.png" alt="Entro.py" className="h-8" />
                            </div>
                            <a href="all_converters.html" className="text-sm font-medium text-[#184B44] hover:text-[#2a6e64] transition-colors flex items-center gap-1">
                                <ArrowLeft /> Back to Tools
                            </a>
                        </div>
                    </header>

                    <main className="flex-grow max-w-5xl mx-auto px-6 py-12 w-full z-0">
                         <div className="text-center mb-10 animate-fade-up">
                            <h1 className="text-3xl font-bold text-[#184B44] mb-3">Standard Error & CI Conversion</h1>
                            <p className="text-slate-600 max-w-2xl mx-auto">
                                Convert between standard errors and confidence intervals for display and downstream calculations.
                            </p>
                        </div>

                         <div className="max-w-3xl mx-auto mb-8 animate-fade-up" style={{animationDelay: '0.1s'}}>
                            <div className="bg-[#fffbeb] border border-[#fcd34d] rounded-lg p-5 shadow-sm">
                                <h3 className="font-semibold text-[#92400e] flex items-center gap-2 mb-2">
                                    <AlertCircle /> Assumptions
                                </h3>
                                <ul className="list-disc pl-5 space-y-1 text-sm text-[#92400e]/90">
                                    <li>Independent observations.</li>
                                    <li>Standard deviation refers to the same sample used for the mean.</li>
                                    <li>Sample is adequately large / at least normally distributed.</li>
                                </ul>
                            </div>
                        </div>

                        <div className="tool-card animate-fade-up" style={{animationDelay: '0.2s'}}>
                            {/* Controls */}
                            <div className="flex flex-col gap-6 mb-8 border-b border-slate-100 pb-6">
                                <div className="flex flex-wrap items-center justify-between gap-4">
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => { setMode('se_to_ci'); setResults([]); }}
                                            className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${mode === 'se_to_ci' ? 'bg-[#184B44] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                                        >
                                            SE → CI
                                        </button>
                                        <button 
                                            onClick={() => { setMode('ci_to_se'); setResults([]); }}
                                            className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${mode === 'ci_to_se' ? 'bg-[#184B44] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                                        >
                                            CI → SE
                                        </button>
                                    </div>

                                    <div className="flex items-center gap-4">
                                        <div className="flex items-center gap-2">
                                            <span className={`text-sm font-medium ${sides === 'one' ? 'text-[#184B44]' : 'text-slate-400'}`}>One-Sided</span>
                                            <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                                <input type="checkbox" name="toggle" id="toggle" className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" checked={sides === 'two'} onChange={() => setSides(s => s === 'one' ? 'two' : 'one')}/>
                                                <label htmlFor="toggle" className="toggle-label block overflow-hidden h-6 rounded-full bg-slate-300 cursor-pointer"></label>
                                            </div>
                                            <span className={`text-sm font-medium ${sides === 'two' ? 'text-[#184B44]' : 'text-slate-400'}`}>Two-Sided</span>
                                        </div>
                                        {/* Info Icon for Sidedness - Always Visible */}
                                        <button onClick={() => setModalContent('two-sided')} className="text-[#184B44] hover:bg-[#e6fffa] p-2 rounded-full transition-colors"><Info /></button>
                                    </div>
                                </div>
                                
                                {/* Extra Slider for One-Sided Direction */}
                                {sides === 'one' && (
                                    <div className="flex items-center justify-center gap-4 bg-slate-50 p-3 rounded-lg border border-slate-200 animate-fade-up">
                                        <span className={`text-sm font-medium ${tail === 'left' ? 'text-[#184B44]' : 'text-slate-400'}`}>Left Tailed (Lower Bound)</span>
                                        <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                            <input type="checkbox" className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" checked={tail === 'right'} onChange={() => setTail(t => t === 'left' ? 'right' : 'left')}/>
                                            <label className="toggle-label block overflow-hidden h-6 rounded-full bg-slate-300 cursor-pointer"></label>
                                        </div>
                                        <span className={`text-sm font-medium ${tail === 'right' ? 'text-[#184B44]' : 'text-slate-400'}`}>Right Tailed (Upper Bound)</span>
                                        {/* Info Icon for One-Sided Tail - Conditional */}
                                        <button onClick={() => setModalContent('one-sided')} className="text-[#184B44] hover:bg-[#e6fffa] p-2 rounded-full transition-colors"><Info /></button>
                                    </div>
                                )}
                            </div>

                            {/* Manual vs File Upload Toggle */}
                            <div className="flex gap-2 mb-6">
                                <button 
                                    onClick={() => { setInputType('manual'); setShowColumnSelector(false); }}
                                    className={`text-xs px-3 py-1 rounded border ${inputType === 'manual' ? 'bg-slate-100 border-slate-300 font-semibold' : 'border-transparent text-slate-400'}`}
                                >
                                    Manual Entry
                                </button>
                                <button 
                                    onClick={() => { setInputType('file'); if(fileData) setShowColumnSelector(true); }}
                                    className={`text-xs px-3 py-1 rounded border ${inputType === 'file' ? 'bg-slate-100 border-slate-300 font-semibold' : 'border-transparent text-slate-400'}`}
                                >
                                    Upload File
                                </button>
                            </div>

                             {/* File Upload Area */}
                             {inputType === 'file' && !showColumnSelector && (
                                <div 
                                    className="h-32 border-2 border-dashed border-slate-300 rounded-lg flex flex-col items-center justify-center p-4 cursor-pointer hover:bg-slate-50 transition-colors mb-8"
                                    onClick={() => fileInputRef.current.click()}
                                >
                                    <UploadCloud />
                                    <span className="text-sm text-slate-500 mt-2">Click to upload .csv, .txt, or .xlsx</span>
                                    <input 
                                        type="file" 
                                        ref={fileInputRef} 
                                        className="hidden" 
                                        accept=".csv,.txt,.xlsx,.xls" 
                                        onChange={handleFileUpload} 
                                    />
                                </div>
                            )}

                             {/* Column Selector */}
                             {inputType === 'file' && showColumnSelector && (
                                <div className="p-4 bg-slate-50 border border-slate-200 rounded-lg mb-8 animate-fade-up">
                                    <h4 className="text-sm font-semibold text-slate-700 mb-3">Map Columns from File:</h4>
                                    
                                    {/* Helper function to generate options */}
                                    {(() => {
                                        const Options = () => headers.map((h, i) => <option key={i} value={i}>{h || `Column ${i+1}`}</option>);
                                        return (
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="text-xs text-slate-500 block mb-1">Confidence Level %</label>
                                                    <select className="w-full p-2 border border-slate-300 rounded text-sm" value={colConf} onChange={(e) => setColConf(e.target.value)}>
                                                        <option value="">-- Optional (Default 95) --</option>
                                                        <Options />
                                                    </select>
                                                </div>

                                                {(mode === 'se_to_ci' || (mode === 'ci_to_se' && sides === 'one')) && (
                                                    <div>
                                                        <label className="text-xs text-slate-500 block mb-1">Mean Estimate</label>
                                                        <select className="w-full p-2 border border-slate-300 rounded text-sm" value={colMean} onChange={(e) => setColMean(e.target.value)}>
                                                            <option value="">-- Select --</option>
                                                            <Options />
                                                        </select>
                                                    </div>
                                                )}

                                                {mode === 'se_to_ci' && (
                                                    <div>
                                                        <label className="text-xs text-slate-500 block mb-1">Standard Error</label>
                                                        <select className="w-full p-2 border border-slate-300 rounded text-sm" value={colSE} onChange={(e) => setColSE(e.target.value)}>
                                                            <option value="">-- Select --</option>
                                                            <Options />
                                                        </select>
                                                    </div>
                                                )}

                                                {(mode === 'ci_to_se' && (sides === 'two' || (sides === 'one' && tail === 'left'))) && (
                                                    <div>
                                                        <label className="text-xs text-slate-500 block mb-1">Lower CI Limit</label>
                                                        <select className="w-full p-2 border border-slate-300 rounded text-sm" value={colLower} onChange={(e) => setColLower(e.target.value)}>
                                                            <option value="">-- Select --</option>
                                                            <Options />
                                                        </select>
                                                    </div>
                                                )}

                                                {(mode === 'ci_to_se' && (sides === 'two' || (sides === 'one' && tail === 'right'))) && (
                                                    <div>
                                                        <label className="text-xs text-slate-500 block mb-1">Upper CI Limit</label>
                                                        <select className="w-full p-2 border border-slate-300 rounded text-sm" value={colUpper} onChange={(e) => setColUpper(e.target.value)}>
                                                            <option value="">-- Select --</option>
                                                            <Options />
                                                        </select>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })()}

                                    <div className="flex gap-2 mt-4">
                                        <button onClick={handleFileProcess} className="btn-brand flex-grow justify-center text-xs">
                                            Populate Data
                                        </button>
                                        <button onClick={() => { setShowColumnSelector(false); setInputType('file'); }} className="btn-secondary text-xs">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Input Fields (Manual Entry - Visible after File Process or if Manual Selected) */}
                            {(inputType === 'manual') && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                                    <div className="space-y-4">
                                        {/* Common Inputs */}
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Confidence Level % (comma-separated)</label>
                                            <textarea className="w-full h-16 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#184B44] focus:border-[#184B44] outline-none resize-none font-mono text-sm" placeholder="95, 99, 90" value={confInput} onChange={(e) => setConfInput(e.target.value)}></textarea>
                                        </div>

                                        {mode === 'se_to_ci' ? (
                                            <>
                                                <div>
                                                    <label className="block text-sm font-medium text-slate-700 mb-1">Mean Estimate (comma-separated)</label>
                                                    <textarea className="w-full h-24 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#184B44] focus:border-[#184B44] outline-none resize-none font-mono text-sm" placeholder="10.5, 20.1" value={meanInput} onChange={(e) => setMeanInput(e.target.value)}></textarea>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-slate-700 mb-1">Standard Error (comma-separated)</label>
                                                    <textarea className="w-full h-24 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#184B44] focus:border-[#184B44] outline-none resize-none font-mono text-sm" placeholder="1.2, 0.5" value={seInput} onChange={(e) => setSeInput(e.target.value)}></textarea>
                                                </div>
                                            </>
                                        ) : (
                                            <>
                                                {/* CI -> SE Inputs */}
                                                
                                                {/* Mean needed for one-sided CI -> SE */}
                                                {sides === 'one' && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-slate-700 mb-1">Mean Estimate (comma-separated)</label>
                                                        <textarea className="w-full h-24 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#184B44] focus:border-[#184B44] outline-none resize-none font-mono text-sm" placeholder="10.5, 20.1" value={meanInput} onChange={(e) => setMeanInput(e.target.value)}></textarea>
                                                    </div>
                                                )}

                                                {/* Lower Limit */}
                                                {(sides === 'two' || (sides === 'one' && tail === 'left')) && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-slate-700 mb-1">Lower CI Limit (comma-separated)</label>
                                                        <textarea className="w-full h-24 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#184B44] focus:border-[#184B44] outline-none resize-none font-mono text-sm" placeholder="8.1, 15.5" value={lowerInput} onChange={(e) => setLowerInput(e.target.value)}></textarea>
                                                    </div>
                                                )}

                                                {/* Upper Limit */}
                                                {(sides === 'two' || (sides === 'one' && tail === 'right')) && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-slate-700 mb-1">Upper CI Limit (comma-separated)</label>
                                                        <textarea className="w-full h-24 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#184B44] focus:border-[#184B44] outline-none resize-none font-mono text-sm" placeholder="12.9, 25.0" value={upperInput} onChange={(e) => setUpperInput(e.target.value)}></textarea>
                                                    </div>
                                                )}
                                            </>
                                        )}

                                        <div className="flex gap-2 pt-2">
                                            <button onClick={handleCalculate} className="btn-brand w-full justify-center"><Calculator /> Calculate</button>
                                            <button onClick={handleReset} className="btn-danger w-auto px-4"><RefreshCw /></button>
                                        </div>
                                    </div>

                                    {/* Results */}
                                    <div className="bg-slate-50 rounded-lg border border-slate-200 p-4 flex flex-col h-full min-h-[300px]">
                                        <div className="flex justify-between items-center mb-3">
                                            <h4 className="text-sm font-semibold text-slate-700">Results</h4>
                                            <div className="flex gap-2">
                                                <button onClick={copyToClipboard} className="p-1 hover:bg-white rounded text-slate-500 hover:text-[#184B44]" title="Copy"><Copy /></button>
                                                <button onClick={exportCSV} className="p-1 hover:bg-white rounded text-slate-500 hover:text-[#184B44]" title="Download CSV"><Download /></button>
                                            </div>
                                        </div>
                                        <div className="flex-grow overflow-y-auto max-h-96 bg-white border border-slate-100 rounded">
                                            <table className="w-full text-sm text-left">
                                                <thead className="bg-slate-50 text-xs uppercase text-slate-500 sticky top-0">
                                                    <tr>
                                                        <th className="px-4 py-2 border-b">Input</th>
                                                        <th className="px-4 py-2 border-b">
                                                            {mode === 'se_to_ci' ? (sides === 'two' ? 'CI Range' : (tail === 'right' ? 'Upper Bound' : 'Lower Bound')) : 'Std Error'}
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-100">
                                                    {results.length === 0 ? (
                                                        <tr><td colSpan="2" className="px-4 py-8 text-center text-slate-400 italic">No data calculated yet.</td></tr>
                                                    ) : (
                                                        results.map((row) => (
                                                            <tr key={row.id}>
                                                                <td className="px-4 py-2 font-mono text-slate-600 border-r border-slate-100 max-w-[150px] truncate" title={row.input}>{row.input}</td>
                                                                <td className={`px-4 py-2 font-mono font-medium ${row.error ? 'text-red-500' : 'text-[#184B44]'}`}>
                                                                    {row.error ? row.error : (
                                                                        mode === 'se_to_ci' && sides === 'two' 
                                                                        ? `[${row.output1}, ${row.output2}]` 
                                                                        : row.output1
                                                                    )}
                                                                </td>
                                                            </tr>
                                                        ))
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                         
                        <div className="max-w-3xl mx-auto mt-12 pt-8 border-t border-slate-200 animate-fade-up" style={{animationDelay: '0.3s'}}>
                            <h3 className="text-sm font-bold text-slate-800 mb-3 uppercase tracking-wider">Reference</h3>
                            <div className="text-xs text-slate-500 leading-relaxed">
                                <p>Altman, D. G., & Bland, J. M. (2011). How to obtain the P value from a confidence interval. BMJ, 343, d2304. <a href="https://doi.org/10.1136/bmj.d2304" target="_blank" className="text-[#184B44] hover:underline">https://doi.org/10.1136/bmj.d2304</a></p>
                            </div>
                        </div>
                    </main>

                    {/* Modal */}
                    {modalContent && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay" onClick={() => setModalContent(null)}>
                            <div className="bg-white rounded-xl max-w-2xl w-full p-6 shadow-2xl relative animate-fade-up" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setModalContent(null)} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><XIcon /></button>
                                
                                {modalContent === 'two-sided' ? (
                                    <>
                                        <h3 className="text-xl font-bold text-[#184B44] mb-4">One-Sided vs Two-Sided Intervals</h3>
                                        <div className="mb-4">
                                            <img src="Two One sided.jpg" alt="One vs Two Sided" className="w-full rounded-lg border border-slate-200" style={{aspectRatio: "11/6"}} />
                                        </div>
                                        <p className="text-sm text-slate-600 leading-relaxed">
                                            Choosing the right interval depends on whether you need to account for deviations in both directions or just one. A <strong>two-sided interval</strong> is used when any change is relevant, like testing if a new medication changes blood pressure either higher or lower than the current standard. A <strong>one-sided interval</strong> is used when you only care about a specific directional benefit, such as verifying that a new car battery lasts longer than the previous model.
                                        </p>
                                    </>
                                ) : (
                                    <>
                                        <h3 className="text-xl font-bold text-[#184B44] mb-4">One-Sided Confidence Intervals</h3>
                                        <div className="mb-4">
                                            <img src="One sided CI.png" alt="One Sided CI" className="w-full rounded-lg border border-slate-200" style={{aspectRatio: "11/6"}} />
                                        </div>
                                        <p className="text-sm text-slate-600 leading-relaxed">
                                            A <strong>one-sided confidence interval</strong> puts the entire significance level α into one tail (the shaded rejection region), so you get just one bound at confidence 1−α instead of two. In the <strong>left-tailed / lower-bound</strong> case, the interval is [L, ∞), meaning “we’re 95% confident the true value is at least L,” which fits questions like “Is a lightbulb’s mean lifetime ≥ 10,000 hours?” In the <strong>right-tailed / upper-bound</strong> case, the interval is (−∞, U], meaning “we’re 95% confident the true value is no more than U,” which fits questions like “Is average pollution ≤ the safety threshold?” You use a one-tailed CI when only one direction matters (and you’re willing to ignore the other), and it lines up with a one-tailed test: if the spec/null value falls beyond your one-sided bound in the wrong direction, you’d reject at level α.
                                        </p>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    <footer className="bg-white border-t border-slate-200">
                        <div className="max-w-7xl mx-auto px-6 py-8 flex flex-col items-center justify-center gap-4">
                            <div className="flex items-center gap-2 opacity-80 hover:opacity-100 transition-opacity">
                                <span className="text-sm font-semibold text-[#184B44]">Entro.py</span>
                                <span className="text-slate-300">|</span>
                                <span className="text-sm text-slate-500">Threadminds</span>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
